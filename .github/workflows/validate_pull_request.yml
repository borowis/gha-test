name: Validate PR title and labels

on:
  pull_request_target:
    types:
      - opened
      - reopened
      - edited
      - synchronize
      - labeled
      - unlabeled

jobs:
  validate_pull_request:
    name: Validate PR
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR title
        run: |
          # Check if PR title starts with "SDS-"
          if ! echo "${{ github.event.pull_request.title }}" | grep -qE '^SDS-[0-9]{4,5} '; then
            echo "Error: Pull request title must start with 'SDS-<JIRA ID> '"
            exit 1
          fi

      - name: Validate PR labels
        run: |
          # Check if "do not merge" label is present
          labels="${{ toJson(github.event.pull_request.labels) }}"
          echo "$labels"
          if echo "$labels' | jq -r '.[].name' | grep -qE 'do not merge'; then
            echo "Error: Pull request has 'do not merge' label"
            exit 1
          fi